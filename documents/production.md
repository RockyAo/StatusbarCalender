太棒了！开发一个 macOS 原生状态栏应用（Menu Bar App）是一个非常经典且实用的切入点。macOS 用户非常看重**简洁、高效和系统集成感**。

下面我为你起草了一份详细的产品文档（PRD）和技术文档。

---

## 一、 产品需求文档 (PRD)

### 1. 项目概述

这款应用旨在为 macOS 用户提供一个高度可定制的状态栏日历工具，填补系统自带日历在显示阴历、节假日及调休信息方面的空白。

### 2. 核心功能

* **状态栏自定义显示**：支持阴历、周几、24/12小时制、秒显。
* **悬浮/点击预览**：鼠标触发后展示完整日历面板。
* **中国农历与节假日**：集成中国特有的法定节假日及调休补班逻辑。

### 3. 功能详细说明

| 功能模块 | 需求描述 | 备注 |
| --- | --- | --- |
| **状态栏配置** | 用户可自由组合：`[日期] [阴历] [星期] [时间]`。 | 提供格式预览。 |
| **时间显示** | 1. 支持 24h/12h 切换；2. 支持 AM/PM 标识；3. 秒针开关。 | 实时刷新频率控制。 |
| **日历面板** | 显示当前月视图，突出显示周末、法定节假日（红点）和补班（班字）。 | 类似系统通知中心风格。 |
| **数据同步** | 自动获取每年国务院公布的放假安排。 | 需支持离线缓存。 |

### 4. UI/UX 设计建议

* **交互逻辑**：虽然你提到“停留（Hover）”，但在 macOS 规范中，点击（Click）触发 Popover 更符合用户习惯。建议支持“点击打开，停留预览（可选）”。
* **视觉风格**：适配 macOS 的深色/浅色模式，使用 `Visual Effect View` 实现毛玻璃效果。

---

## 二、 技术方案文档

### 1. 技术栈选择

* **语言**：Swift 5.x
* **框架**：**SwiftUI** (界面) + **AppKit** (系统状态栏管理)
* **系统要求**：macOS 12.0+

### 2. 核心架构设计

应用将采用典型的 **MVVM 架构**：

* **Model**: 处理日期计算、农历转换算法、节假日 JSON 解析。
* **ViewModel**: 负责状态栏字符串的格式化逻辑、倒计时刷新。
* **View**: 使用 `NSPopover` 承载 SwiftUI 编写的日历视图。

### 3. 关键技术实现点

#### A. 状态栏管理 (`NSStatusItem`)

在 macOS 中，状态栏应用不使用传统的 `Window`。

```swift
// 伪代码示例
let statusItem = NSStatusBar.system.statusItem(withLength: NSStatusItem.variableLength)

func updateStatusBar() {
    if let button = statusItem.button {
        button.title = "10月24日 周四 农历九月廿二 14:00:05"
        // 添加 TrackingArea 实现悬浮监听
    }
}

```

#### B. 悬浮展开逻辑

由于状态栏按钮默认不响应 `mouseEntered`，你需要子类化 `NSStatusBarButton` 或添加 `NSTrackingArea` 来捕获鼠标停留事件，从而弹出 `NSPopover`。

#### C. 中国农历与节假日数据

* **农历计算**：推荐使用 Swift 原生的 `Calendar(identifier: .chinese)`，它可以直接处理大部分农历转换逻辑。
* **节假日与调休**：建议内置一个 `holidays.json` 文件，并提供远程更新机制（如同步 GitHub 上的开源节假日数据集），因为调休日期每年都会变。

#### D. 性能优化

* **刷新率控制**：如果不显示“秒”，UI 刷新频率应限制在每分钟一次；如果显示“秒”，需开启 `Timer` 每一秒刷新一次，注意能耗。

---

## 三、 实施计划 (Roadmap)

1. **Phase 1**: 实现基础状态栏显示，支持自定义格式字符串。
2. **Phase 2**: 开发日历面板 UI，集成 `Calendar` 核心组件。
3. **Phase 3**: 注入中国农历算法及节假日、调休逻辑。
4. **Phase 4**: 优化内存占用与 CPU 唤醒频率，适配多屏显示。

