è¿™ä»½æ–‡æ¡£å·²æ ¹æ®ä½ çš„è¦æ±‚è¿›è¡Œäº†å…¨é¢é‡æ„ã€‚å®ƒå°† **Figma è®¾è®¡ç¨¿**ä½œä¸ºè§†è§‰å”¯ä¸€äº‹å®æ¥æºï¼ˆSource of Truthï¼‰ï¼Œå¹¶ç»“åˆ **Swift 6** çš„ä¸¥æ ¼å¹¶å‘ç‰¹æ€§ï¼Œä¸º AI è¾…åŠ©ç¼–ç¨‹ï¼ˆVibecodingï¼‰æä¾›ç²¾ç¡®çš„çº¦æŸã€‚

---

# ğŸ“… macOS çŠ¶æ€æ æ—¥å†é¡¹ç›®ï¼šäº§å“ä¸æŠ€æœ¯æ·±åº¦è§„çº¦ (V2.0)

## ä¸€ã€ äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

### 1. æ ¸å¿ƒå®šä½

ä¸€æ¬¾æ·±åº¦é›†æˆäº macOS çŠ¶æ€æ çš„è½»é‡çº§æ—¥å†ï¼Œå®Œç¾é€‚é…ä¸­å›½å†œå†ä¸æ³•å®šèŠ‚å‡æ—¥æ’ç­ï¼Œè§†è§‰é£æ ¼ä¸¥æ ¼éµå¾ª **Figma è®¾è®¡ç¨¿**ã€‚

### 2. æ ¸å¿ƒåŠŸèƒ½çœ‹æ¿

* **çŠ¶æ€æ æ¸²æŸ“ (Dynamic Item)**ï¼š
* æ”¯æŒ `[æ—¥æœŸ] [å†œå†] [å‘¨å‡ ] [æ—¶é—´]` çš„ä»»æ„ç»„åˆã€‚
* æ—¶é—´æ”¯æŒ 12/24 å°æ—¶åˆ¶åˆ‡æ¢ï¼Œæ”¯æŒç§’çº§å®æ—¶åˆ·æ–°ï¼ˆç”±è®¾ç½®æ§åˆ¶å¼€å…³ï¼‰ã€‚


* **æ—¥å†äº¤äº’é¢æ¿ (Main Popover)**ï¼š
* **è§¦å‘æœºåˆ¶**ï¼šæ”¯æŒç‚¹å‡»è§¦å‘ï¼ˆmacOS æ ‡å‡†ï¼‰æˆ–é¼ æ ‡æ‚¬åœï¼ˆHoverï¼‰è§¦å‘ï¼ˆéœ€é€šè¿‡ `NSTrackingArea` å®ç°ï¼‰ã€‚
* **è§†è§‰å‘ˆç°**ï¼šé‡‡ç”¨ Figma ä¸­çš„åœ†è§’å¸ƒå±€ä¸æ¯›ç»ç’ƒæ•ˆæœï¼ˆVibrant Materialï¼‰ã€‚
* **å†…å®¹å±‚çº§**ï¼šæœˆè§†å›¾ç½‘æ ¼ã€æ³•å®šèŠ‚å‡æ—¥ï¼ˆä¼‘/ç­ï¼‰è§’æ ‡ã€ä»Šæ—¥è¯¦æƒ…ï¼ˆå†œå†/å¹²æ”¯/ç”Ÿè‚–ï¼‰ã€‚


* **èŠ‚å‡æ—¥äº‘åŒæ­¥**ï¼š
* è‡ªåŠ¨åŒæ­¥ä¸­å›½æ”¿åºœå‘å¸ƒçš„å¹´åº¦è°ƒä¼‘å®‰æ’ï¼Œæ”¯æŒæœ¬åœ°ç¼“å­˜ï¼Œæ— ç½‘ç»œæ—¶ä¾ç„¶å¯ç”¨ã€‚



### 3. UI/UX è®¾è®¡æ ‡å‡† (åŸºäº Figma)

* **é…è‰²**ï¼šä½¿ç”¨ç³»ç»Ÿçº§å¼ºè°ƒè‰²ï¼ˆAccent Colorï¼‰ï¼Œé€‚é… Light/Dark æ¨¡å¼ã€‚
* **å­—ä½“**ï¼šé‡‡ç”¨ç³»ç»Ÿé»˜è®¤å­—ä½“ï¼ˆSan Franciscoï¼‰ï¼Œå­—é‡ï¼ˆWeightï¼‰éœ€ä¸¥æ ¼å¯¹åº” Figma æ ‡æ³¨ã€‚
* **è§’æ ‡è®¾è®¡**ï¼š
* **â€œä¼‘â€**ï¼šFigma æŒ‡å®šè‰²å€¼ï¼ˆé€šå¸¸ä¸ºçº¢è‰²/æ©™è‰²ç³»ï¼‰ï¼Œç½®äºæ—¥æœŸå³ä¸Šè§’ã€‚
* **â€œç­â€**ï¼šFigma æŒ‡å®šè‰²å€¼ï¼ˆé€šå¸¸ä¸ºç°è‰²/è“è‰²ç³»ï¼‰ï¼Œç½®äºæ—¥æœŸå³ä¸Šè§’ã€‚



---

## äºŒã€ æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£ (Vibecoding ä¸“ç”¨)

### 1. æ¶æ„çº¦æŸ (Architecture)

* **è¯­è¨€ç‰ˆæœ¬**ï¼šSwift 6 (å¼ºåˆ¶å¼€å¯ `Complete Concurrency Checking`)ã€‚
* **UI æ¡†æ¶**ï¼šSwiftUI (ä¸ºä¸») + AppKit (ç”¨äºå¤„ç† `NSStatusItem` çš„åº•å±‚äº¤äº’)ã€‚
* **çŠ¶æ€ç®¡ç†**ï¼šä½¿ç”¨ Swift 6 çš„ `@Observable` å®ï¼Œå¼ƒç”¨ `ObservableObject`ã€‚
* **å¹¶å‘æ¨¡å‹**ï¼šæ‰€æœ‰çš„ UI çŠ¶æ€æ›´æ–°å¿…é¡»åœ¨ `@MainActor` ä¸­è¿›è¡Œã€‚

### 2. æ•°æ®è·å–æ–¹æ¡ˆ (Holiday Data)

* **æœ¬åœ°å¼•æ“**ï¼šä½¿ç”¨ `Calendar(identifier: .chinese)` å¤„ç†æ‰€æœ‰å†œå†é€»è¾‘ï¼ˆæ— éœ€åç«¯ï¼‰ã€‚
* **èŠ‚å‡æ—¥åŒæ­¥**ï¼š
* **ç­–ç•¥**ï¼šåº”ç”¨å†…ç½®ä¸€ä»½ `holidays_initial.json`ï¼Œå¯åŠ¨åå¼‚æ­¥è¯·æ±‚ GitHub ä¸Šçš„é™æ€æ•°æ®æºï¼ˆå¦‚ï¼š`Niumo/china-holiday-cal` æˆ–è‡ªå»ºä»“åº“ï¼‰ã€‚
* **åç«¯éœ€æ±‚**ï¼š**ä¸éœ€è¦æ„å»ºåç«¯å·¥ç¨‹**ã€‚ç›´æ¥åˆ©ç”¨ GitHub Pages æˆ– Vercel æ‰˜ç®¡ä¸€ä¸ªé™æ€ JSON å³å¯å®ç°æ¯å¹´è‡ªåŠ¨æ›´æ–°ã€‚



### 3. ç»„ä»¶åŒ–ç»“æ„è®¾è®¡

ä¸ºäº†è®© AI é«˜æ•ˆç”Ÿæˆä»£ç ï¼Œæˆ‘ä»¬å°† UI æ‹†è§£ä¸ºä»¥ä¸‹ç»„ä»¶ï¼š

| ç»„ä»¶å | åŠŸèƒ½æè¿° | æ˜ å°„ Figma æ¨¡å— |
| --- | --- | --- |
| `StatusView` | çŠ¶æ€æ æ˜¾ç¤ºçš„ Text ç»„åˆé€»è¾‘ | çŠ¶æ€æ æ¡ç›® |
| `CalendarGrid` | 7x6 å¸ƒå±€ï¼Œå¤„ç†æ—¥æœŸæº¢å‡ºåŠæœˆä»½åˆ‡æ¢ | ä¸»æ—¥å†ç½‘æ ¼ |
| `DayCell` | å•ä¸ªæ—¥æœŸï¼Œå¤„ç†â€œä¼‘/ç­â€è§’æ ‡æ˜¾ç¤ºé€»è¾‘ | æ—¥æœŸå•å…ƒæ ¼ |
| `HolidayService` | å¤„ç† JSON ä¸‹è½½ã€è§£æä¸æœ¬åœ°æŒä¹…åŒ– | æ•°æ®å±‚ |
| `HoverProvider` | ç›‘å¬é¼ æ ‡ä½ç½®ä»¥è§¦å‘ Popover çš„ AppKit æ¡¥æ¥å™¨ | äº¤äº’å±‚ |

---

## ä¸‰ã€ AI æŒ‡ä»¤é›† (Constraints for AI)

> **åœ¨ä½¿ç”¨ AIï¼ˆå¦‚ Cursor/Claudeï¼‰è¿›è¡Œå¼€å‘æ—¶ï¼Œè¯·å°†ä»¥ä¸‹çº¦æŸç²˜è´´ç»™å®ƒï¼š**

### âš ï¸ ç¼–ç è§„èŒƒçº¦æŸï¼š

1. **ç¦æ­¢é—ç•™ä»£ç **ï¼šä¸è¦ä½¿ç”¨ `Combine` çš„ `AnyCancellable` æˆ– `ObservableObject`ï¼Œç»Ÿä¸€ä½¿ç”¨ Swift 6 çš„åŸç”Ÿ `Task` å’Œ `@Observable`ã€‚
2. **UI è¿˜åŸåº¦**ï¼šè¯·ä¸¥æ ¼å‚ç…§ Figma é“¾æ¥ä¸­çš„é—´è·ï¼ˆPaddingï¼‰ã€åœ†è§’ï¼ˆCorner Radiusï¼‰å’Œé€æ˜åº¦ï¼ˆOpacityï¼‰ã€‚
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šçŠ¶æ€æ çš„â€œç§’â€åˆ·æ–°å¿…é¡»ä½¿ç”¨ `TimelineView` ä¸”ä»…åœ¨é…ç½®å¼€å¯æ—¶æ¿€æ´»ï¼Œé¿å…ä¸å¿…è¦çš„ CPU å”¤é†’ã€‚
4. **çº¿ç¨‹å®‰å…¨**ï¼šæ‰€æœ‰ä» `HolidayService` è¿”å›çš„æ•°æ®å¿…é¡»æ ‡è®°ä¸º `Sendable`ã€‚

### ğŸ›  æ¨èçš„å¼€å‘æ­¥éª¤ï¼ˆåˆ†æ­¥æç¤ºè¯ï¼‰ï¼š

* **Step 1 (åŸºç¡€)**: "ç”Ÿæˆä¸€ä¸ªåŸºäº SwiftUI çš„ macOS èœå•æ åº”ç”¨æ¡†æ¶ï¼Œä½¿ç”¨ Swift 6 è§„èŒƒã€‚å®ç°ä¸€ä¸ª `ClockManager` åœ¨çŠ¶æ€æ æ˜¾ç¤ºæ—¶é—´ï¼Œæ”¯æŒé€šè¿‡ `@Observable` åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºç§’ã€‚"
* **Step 2 (UI é™æ€)**: "å‚è€ƒ Figma UIï¼Œä½¿ç”¨ `LazyVGrid` æ„å»ºæ—¥å†çš„ä¸»ä½“é¢æ¿ã€‚è¦æ±‚å®ç°è‡ªå®šä¹‰çš„ `DayCell`ï¼Œèƒ½å±•ç¤ºæ—¥æœŸæ•°å­—å’Œä¸‹æ–¹çš„å°å­—å†œå†ã€‚"
* **Step 3 (ä¸šåŠ¡é€»è¾‘)**: "ç¼–å†™ `HolidayService`ã€‚åŠŸèƒ½ï¼š1. ä½¿ç”¨ `Calendar.chinese` è®¡ç®—å†œå†ï¼›2. å¼‚æ­¥è¯·æ±‚æŒ‡å®šçš„ JSON é“¾æ¥è·å–è°ƒä¼‘æ•°æ®ï¼›3. åœ¨ `DayCell` å³ä¸Šè§’æ¸²æŸ“â€˜ä¼‘â€™å’Œâ€˜ç­â€™çš„æ ‡è®°ã€‚"
* **Step 4 (äº¤äº’å¢å¼º)**: "ä½¿ç”¨ `NSViewRepresentable` åŒ…è£…ä¸€ä¸ªé€æ˜çš„è§†å›¾ï¼Œæ•æ‰é¼ æ ‡åœ¨çŠ¶æ€æ å›¾æ ‡ä¸Šçš„ `mouseEntered` äº‹ä»¶ï¼Œä»è€Œè§¦å‘ SwiftUI é¢æ¿çš„æ˜¾ç¤ºã€‚"

---

## å››ã€ æ ¸å¿ƒæ•°æ®æ¨¡å‹ (Swift 6)

```swift
import Foundation
import SwiftUI

/// èŠ‚å‡æ—¥ç±»å‹å®šä¹‰
enum DayStatus: String, Codable, Sendable {
    case holiday // ä¼‘
    case work    // ç­
    case normal  // æ™®é€š
}

/// æ¯æ—¥è¯¦ç»†æ•°æ®æ¨¡å‹
@Observable @MainActor
class DayViewModel {
    let date: Date
    var lunarText: String = ""
    var status: DayStatus = .normal
    var holidayName: String? = nil
    
    // åŸºäº Swift 6 çš„å¼‚æ­¥åˆå§‹åŒ–
    init(date: Date) {
        self.date = date
        self.calculateLunar()
    }
    
    private func calculateLunar() {
        let calendar = Calendar(identifier: .chinese)
        // å†œå†è®¡ç®—é€»è¾‘...
    }
}

```

### ç»™ä½ çš„åç»­æ“ä½œå»ºè®®ï¼š

1. **æˆªå›¾ Figma**ï¼šåœ¨ Vibecoding æ—¶ï¼Œå¦‚æœ AI æ— æ³•ç›´æ¥è¯»å–é“¾æ¥ï¼Œ**ç›´æ¥å°† Figma å…³é”®ç•Œé¢çš„æˆªå›¾æ‹–ç»™ AI**ï¼Œå¹¶å‘Šè¯‰å®ƒï¼šâ€œæŒ‰å›¾ä¸­çš„é¢œè‰²å’Œé—´è·è¿˜åŸ SwiftUI ä»£ç â€ã€‚
2. **æ•°æ®æºåœ°å€**ï¼šä½ å¯ä»¥å…ˆæ‰¾ä¸€ä¸ªæˆç†Ÿçš„ GitHub èŠ‚å‡æ—¥ API é“¾æ¥ï¼Œåœ¨ Step 3 ä¸­ç›´æ¥æä¾›ç»™ AIã€‚
3. **æµ‹è¯•**ï¼šé‡ç‚¹æµ‹è¯•è·¨å¹´ï¼ˆå¦‚ 12 æœˆåˆ‡æ¢åˆ° 1 æœˆï¼‰æ—¶çš„æ—¥æœŸæ’å¸ƒé€»è¾‘ã€‚