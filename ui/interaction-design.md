# 交互设计规范

详细定义应用的交互逻辑、手势、动效参数和用户体验流程。

---

## 🖱️ 交互模式

### 1. 状态栏交互

#### 触发方式

| 交互 | 行为 | 条件 |
|------|------|------|
| **左键点击** | 显示/隐藏 Popover | 默认 |
| **悬停 0.3s** | 显示 Popover | 设置开启时 |
| **右键点击** | 显示上下文菜单 | - |
| **拖拽** | 调整位置 | macOS 系统行为 |

#### 上下文菜单

```
┌─────────────────────┐
│ 显示日历...          │
│ ─────────────────── │
│ 偏好设置...      ⌘, │
│ ─────────────────── │
│ 退出              ⌘Q │
└─────────────────────┘
```

---

### 2. 日历面板交互

#### 导航操作

| 操作 | 触发方式 | 行为 |
|------|----------|------|
| **上一月** | 点击 `<` 按钮 | 切换到上月，左滑动画 |
| **下一月** | 点击 `>` 按钮 | 切换到下月，右滑动画 |
| **回到今天** | 点击 `○` 按钮 | 跳转到当前月份和日期 |
| **年月选择** | 点击 "2024年 10月" | 弹出年月选择器 |
| **快捷键 ←** | 键盘左箭头 | 上一月 |
| **快捷键 →** | 键盘右箭头 | 下一月 |
| **快捷键 T** | 键盘 T | 回到今天 (Today) |

#### 日期单元格交互

| 状态 | 视觉反馈 | 行为 |
|------|----------|------|
| **默认** | 普通显示 | - |
| **Hover** | 背景浅色高亮 | 显示更多信息（可选） |
| **点击** | 轻微缩放效果 | 选中该日期（可扩展功能） |
| **长按** | 震动反馈 (触控板) | 显示日期详情菜单 |

#### 面板关闭

| 触发 | 行为 |
|------|------|
| 点击面板外区域 | 关闭面板（淡出动画） |
| 按下 ESC 键 | 关闭面板 |
| 再次点击状态栏 | 关闭面板 |
| 失去焦点 3s | 自动关闭（可选） |

---

### 3. 年月选择器交互

#### 界面布局

```
┌─────────────────────┐
│  选择年月            │
│ ─────────────────── │
│  年份：             │
│  [<] 2024 [>]       │
│                     │
│  月份：             │
│  1  2  3  4         │
│  5  6  7  8         │
│  9 10 11 12         │
│ ─────────────────── │
│  [取消]    [确定]   │
└─────────────────────┘
```

#### 操作方式

- **年份调整**：点击 `<` `>` 按钮或滚动
- **月份选择**：点击对应月份按钮
- **快速跳转**：直接输入年份数字
- **滚轮支持**：鼠标滚轮调整年份

---

## ⌨️ 键盘快捷键

### 全局快捷键

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `⌘⌥C` | 显示/隐藏日历面板 | 可自定义 |
| `⌘,` | 打开设置 | macOS 标准 |
| `⌘Q` | 退出应用 | macOS 标准 |

### 面板内快捷键

| 快捷键 | 功能 |
|--------|------|
| `←` | 上一月 |
| `→` | 下一月 |
| `↑` | 上一年 |
| `↓` | 下一年 |
| `T` | 回到今天 |
| `ESC` | 关闭面板 |
| `Tab` | 切换焦点 |
| `Space` | 选择当前焦点日期 |

### 设置窗口快捷键

| 快捷键 | 功能 |
|--------|------|
| `⌘1` - `⌘5` | 切换到对应 Tab |
| `⌘W` | 关闭设置窗口 |

---

## 🎬 动画规范

### 1. 弹出面板动画

#### 显示动画
```swift
Animation Spec:
  Type: Spring
  Response: 0.25s
  Damping: 0.8
  Initial Velocity: 0
  
Movement:
  From: (0, -10) + opacity 0
  To: (0, 0) + opacity 1
```

#### 隐藏动画
```swift
Animation Spec:
  Type: EaseOut
  Duration: 0.2s
  
Movement:
  From: opacity 1
  To: opacity 0
```

---

### 2. 月份切换动画

#### 切换到下个月
```swift
Animation Spec:
  Type: EaseInOut
  Duration: 0.3s
  
Old Grid:
  From: (0, 0) + opacity 1
  To: (-288, 0) + opacity 0
  
New Grid:
  From: (288, 0) + opacity 0
  To: (0, 0) + opacity 1
```

#### 切换到上个月
```swift
Animation Spec:
  Type: EaseInOut
  Duration: 0.3s
  
Old Grid:
  From: (0, 0) + opacity 1
  To: (288, 0) + opacity 0
  
New Grid:
  From: (-288, 0) + opacity 0
  To: (0, 0) + opacity 1
```

---

### 3. Hover 动画

#### 按钮 Hover
```swift
Animation Spec:
  Type: EaseInOut
  Duration: 0.15s
  
Background:
  From: opacity 0
  To: opacity 0.1
  
Scale:
  From: 1.0
  To: 1.05 (可选)
```

#### 日期单元格 Hover
```swift
Animation Spec:
  Type: EaseOut
  Duration: 0.12s
  
Background:
  From: clear
  To: gray.opacity(0.1)
```

---

### 4. 设置按钮旋转

```swift
Animation Spec:
  Type: EaseInOut
  Duration: 0.2s
  
Rotation:
  On Hover: 0° → 45°
  On Leave: 45° → 0°
```

---

### 5. 加载动画

#### 节假日数据更新中
```
  ⟳ 正在更新节假日数据...
  
Animation:
  Rotation: 360° / 1s (continuous)
  Easing: Linear
```

---

## 📱 手势支持 (触控板)

### 日历面板手势

| 手势 | 行为 |
|------|------|
| **双指左滑** | 下一个月 |
| **双指右滑** | 上一个月 |
| **双指向下滑** | 关闭面板 |
| **捏合放大** | 放大字体（可选） |
| **捏合缩小** | 缩小字体（可选） |

---

## 🔔 反馈机制

### 视觉反馈

| 操作 | 反馈 |
|------|------|
| 按钮点击 | 高亮 + 轻微缩放 |
| 日期选择 | 蓝色圆环包围 |
| 错误操作 | 红色闪烁提示 |
| 成功操作 | 绿色对勾动画 |

### 触觉反馈 (触控板)

| 操作 | 反馈强度 |
|------|----------|
| 普通点击 | 无 |
| 长按日期 | 轻度震动 (Light) |
| 月份切换 | 极轻震动 (Subtle) |
| 错误操作 | 中度震动 (Medium) |

### 音效反馈 (可选)

| 操作 | 音效 |
|------|------|
| 面板弹出 | 系统弹出音 |
| 月份切换 | 翻页音 |
| 日期点击 | 轻点音 |
| 错误操作 | 系统警告音 |

---

## 🎯 焦点管理

### Tab 键导航顺序

#### 日历面板
```
1. 年月显示按钮
2. < 上月按钮
3. ○ 回到今天按钮
4. > 下月按钮
5. 日期网格（按行列顺序）
6. 设置按钮
```

#### 设置窗口
```
1. Tab 标签页
2. 第一个输入项
3. 后续输入项（从上到下）
4. 按钮
```

### 焦点样式

```swift
// 焦点指示器
.focusable()
.focusEffectDisabled(false)
.overlay(
    RoundedRectangle(cornerRadius: 4)
        .strokeBorder(Color.accentColor, lineWidth: 2)
        .opacity(isFocused ? 1.0 : 0.0)
)
```

---

## 🔄 状态转换

### 应用状态机

```
[启动] 
  ↓
[后台运行] ⟷ [显示面板]
  ↓              ↓
[设置窗口] ←→ [显示面板]
  ↓
[退出]
```

### 面板显示状态

```
隐藏 (Hidden)
  ↓ 用户点击/悬停
显示中 (Appearing)
  ↓ 动画完成
已显示 (Visible)
  ↓ 用户点击外部/按ESC
隐藏中 (Disappearing)
  ↓ 动画完成
隐藏 (Hidden)
```

---

## 🎨 加载状态

### 初次启动

```
1. App Icon 淡入
2. 状态栏图标显示
3. 后台加载农历数据
4. 后台加载节假日数据
5. 完成，监听用户交互
```

### 节假日数据更新

```
1. 用户点击"更新数据"
2. 按钮变为 "⟳ 更新中..."
3. 异步下载数据
4. 成功：显示 "✓ 更新成功"
5. 失败：显示 "✗ 更新失败" + 重试按钮
6. 3秒后恢复原按钮
```

---

## ⚠️ 错误处理

### 错误类型与反馈

| 错误类型 | 用户反馈 | 恢复方案 |
|----------|----------|----------|
| 网络错误 | "无法连接到服务器" | 提供重试按钮 |
| 数据解析失败 | "数据格式错误" | 使用缓存数据 |
| 权限不足 | "需要辅助功能权限" | 打开系统设置页面 |
| 未知错误 | "遇到未知问题" | 提供重启应用按钮 |

### 错误提示样式

```
┌────────────────────────────┐
│  ⚠️  无法连接到服务器      │
│                            │
│  请检查网络连接后重试      │
│                            │
│     [重试]    [取消]       │
└────────────────────────────┘
```

---

## ♿️ 无障碍交互

### VoiceOver 支持

#### 状态栏
```
Label: "状态栏日历"
Value: "2024年10月24日 星期四 14时00分"
Hint: "点击显示日历面板"
```

#### 日期单元格
```
Label: "10月15日"
Value: "农历九月廿二"
Hint: "双击查看详情"
Traits: .button
```

#### 节假日标记
```
Label: "休息日" / "补班日"
Value: 日期信息
```

### 键盘完全访问

- 所有交互元素可通过 Tab 键访问
- 按钮可通过 Space 或 Enter 激活
- 支持 VoiceOver 快捷键

### 对比度适配

```swift
// 自动适配"增加对比度"设置
@Environment(\.accessibilityReduceTransparency) 
var reduceTransparency

var background: some View {
    if reduceTransparency {
        Color.white // 纯色背景
    } else {
        VisualEffectBlur() // 毛玻璃背景
    }
}
```

---

## 📊 性能指标

### 交互响应时间目标

| 操作 | 响应时间 |
|------|----------|
| 状态栏点击 → 面板显示 | < 100ms |
| 月份切换 | < 50ms |
| 设置项切换 | < 16ms (1帧) |
| 数据加载 | < 500ms |

### 动画帧率目标

| 动画类型 | 目标帧率 |
|----------|----------|
| 面板弹出 | 60 FPS |
| 月份切换 | 60 FPS |
| Hover 效果 | 60-120 FPS |

---

## 🎪 彩蛋交互 (可选)

### 特殊日期交互

| 日期 | 特殊效果 |
|------|----------|
| 生日 | 🎂 蛋糕图标 + 祝福语 |
| 春节 | 🎆 烟花动画 |
| 中秋节 | 🌕 月亮动画 |
| 圣诞节 | ❄️ 雪花飘落 |

### 隐藏手势

- **连续点击状态栏 5 次**：显示开发者信息
- **长按设置图标 3s**：显示调试菜单

---

## 📋 交互检查清单

- [ ] 所有按钮有明确的 Hover 状态
- [ ] 所有动画时长在 0.1-0.4s 之间
- [ ] 支持键盘完全导航
- [ ] 支持 VoiceOver 朗读
- [ ] 错误状态有明确提示
- [ ] 加载状态有视觉反馈
- [ ] 支持触控板手势
- [ ] 响应时间符合性能目标
- [ ] 面板不会超出屏幕边界
- [ ] 焦点状态清晰可见

---

**文档版本**：v1.0
**最后更新**：2024-10-24
