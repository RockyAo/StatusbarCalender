# 开发路线图

本文档提供了从设计到实现的完整开发路线图。

---

## 🎯 项目阶段

### Phase 1: 基础框架搭建 (Week 1-2)

#### 1.1 项目初始化
- [ ] 创建 Xcode 项目
- [ ] 配置项目结构
- [ ] 集成 SwiftUI
- [ ] 配置 Git 仓库

#### 1.2 状态栏基础功能
- [ ] 创建 AppDelegate
- [ ] 实现 NSStatusItem
- [ ] 基础的状态栏显示
- [ ] 点击弹出/关闭功能

#### 1.3 基础数据模型
- [ ] Date 扩展
- [ ] Calendar 工具类
- [ ] 基础配置管理 (UserDefaults)

**验收标准**：
- ✓ 状态栏显示当前时间
- ✓ 点击可弹出空白面板
- ✓ 面板可以正常关闭

---

### Phase 2: 日历核心功能 (Week 3-4)

#### 2.1 日历网格实现
- [ ] CalendarGrid 组件
- [ ] 日历矩阵算法
- [ ] DateCell 组件
- [ ] 月份切换逻辑

#### 2.2 日历头部和导航
- [ ] CalendarHeader 组件
- [ ] 导航按钮组件
- [ ] 年月选择器
- [ ] 切换动画效果

#### 2.3 基础样式
- [ ] 颜色系统
- [ ] 字体系统
- [ ] 间距系统
- [ ] 毛玻璃效果

**验收标准**：
- ✓ 日历正确显示当月日期
- ✓ 月份切换功能正常
- ✓ 视觉效果符合设计规范

---

### Phase 3: 农历和节气 (Week 5-6)

#### 3.1 农历计算
- [ ] 集成农历算法库
- [ ] LunarDate 模型
- [ ] LunarCalendarService
- [ ] 天干地支计算
- [ ] 生肖计算

#### 3.2 节气计算
- [ ] 节气算法实现
- [ ] 节气数据展示
- [ ] 节气特殊样式

#### 3.3 农历显示
- [ ] DateCell 农历显示
- [ ] Footer 详细农历信息
- [ ] 农历格式配置

**验收标准**：
- ✓ 农历日期显示正确
- ✓ 节气准确标注
- ✓ 天干地支生肖正确

---

### Phase 4: 节假日功能 (Week 7-8)

#### 4.1 节假日数据
- [ ] holidays.json 数据文件
- [ ] HolidayService 实现
- [ ] 数据加载和缓存
- [ ] 在线更新机制

#### 4.2 节假日显示
- [ ] HolidayBadge 组件
- [ ] 休息日标记
- [ ] 补班日标记
- [ ] 节假日名称提示

#### 4.3 传统节日
- [ ] 传统节日数据
- [ ] 节日提示
- [ ] 节日特效 (可选)

**验收标准**：
- ✓ 法定节假日正确标注
- ✓ 调休补班正确显示
- ✓ 数据可以更新

---

### Phase 5: 设置界面 (Week 9-10)

#### 5.1 设置窗口基础
- [ ] SettingsWindow 框架
- [ ] TabView 结构
- [ ] 各 Tab 占位页

#### 5.2 显示设置
- [ ] DisplaySettingsView
- [ ] 状态栏选项开关
- [ ] 农历格式选择
- [ ] 实时预览

#### 5.3 其他设置
- [ ] TimeSettingsView (时间格式)
- [ ] StyleSettingsView (样式配置)
- [ ] HolidaySettingsView (节假日选项)
- [ ] AboutView (关于页面)

**验收标准**：
- ✓ 所有设置项正常工作
- ✓ 设置实时生效
- ✓ 设置持久化保存

---

### Phase 6: 交互优化 (Week 11-12)

#### 6.1 动画效果
- [ ] 面板弹出动画
- [ ] 月份切换动画
- [ ] Hover 效果
- [ ] 按钮动画

#### 6.2 键盘支持
- [ ] 快捷键实现
- [ ] 焦点管理
- [ ] Tab 键导航
- [ ] 方向键导航

#### 6.3 手势支持
- [ ] 触控板滑动
- [ ] 双指手势
- [ ] 捏合缩放 (可选)

**验收标准**：
- ✓ 动画流畅自然
- ✓ 键盘完全可访问
- ✓ 触控板手势正常

---

### Phase 7: 无障碍和优化 (Week 13)

#### 7.1 无障碍支持
- [ ] VoiceOver 标签
- [ ] 对比度适配
- [ ] 动态字体支持
- [ ] 键盘访问优化

#### 7.2 性能优化
- [ ] 日历数据缓存
- [ ] 渲染优化
- [ ] 内存管理
- [ ] 启动速度优化

#### 7.3 多屏适配
- [ ] 多显示器支持
- [ ] 刘海屏适配
- [ ] 边缘检测

**验收标准**：
- ✓ 通过无障碍测试
- ✓ 性能指标达标
- ✓ 多屏正常工作

---

### Phase 8: 高级功能 (Week 14-15)

#### 8.1 开机自启
- [ ] ServiceManagement 集成
- [ ] 启动项配置
- [ ] 设置界面开关

#### 8.2 数据同步 (可选)
- [ ] iCloud 同步
- [ ] 自定义事件
- [ ] 备忘录集成

#### 8.3 彩蛋功能 (可选)
- [ ] 特殊日期效果
- [ ] 节日动画
- [ ] 隐藏功能

**验收标准**：
- ✓ 开机自启正常
- ✓ 可选功能稳定

---

### Phase 9: 测试和修复 (Week 16)

#### 9.1 功能测试
- [ ] 所有功能测试用例
- [ ] 边界条件测试
- [ ] 错误处理测试

#### 9.2 兼容性测试
- [ ] macOS 版本兼容性
- [ ] 不同屏幕分辨率
- [ ] 深色/浅色模式

#### 9.3 Bug 修复
- [ ] 已知问题修复
- [ ] 用户反馈问题
- [ ] 性能问题优化

**验收标准**：
- ✓ 零崩溃
- ✓ 核心功能 100% 通过
- ✓ 已知 Bug 全部修复

---

### Phase 10: 发布准备 (Week 17-18)

#### 10.1 文档完善
- [ ] README.md
- [ ] 使用手册
- [ ] 更新日志
- [ ] 贡献指南

#### 10.2 应用签名和公证
- [ ] 代码签名
- [ ] App 公证
- [ ] DMG 制作

#### 10.3 发布渠道
- [ ] GitHub Release
- [ ] App Store (可选)
- [ ] 官网下载页

**验收标准**：
- ✓ 文档完整
- ✓ 应用已签名
- ✓ 可以正常分发

---

## 📋 技术选型

### 必需技术
- **语言**: Swift 5.5+
- **框架**: SwiftUI, AppKit
- **最低系统**: macOS 12.0+
- **开发工具**: Xcode 14+

### 推荐依赖库
```swift
// Swift Package Manager

dependencies: [
    // 农历库
    .package(url: "https://github.com/isee15/Lunar-Swift", from: "1.0.0"),
    
    // 日期工具 (可选)
    .package(url: "https://github.com/malcommac/SwiftDate", from: "7.0.0"),
]
```

---

## 🎯 里程碑目标

| 里程碑 | 时间 | 目标 |
|--------|------|------|
| **M1: MVP** | Week 4 | 基础日历功能可用 |
| **M2: Alpha** | Week 8 | 农历、节假日功能完整 |
| **M3: Beta** | Week 12 | 设置界面、交互完善 |
| **M4: RC** | Week 16 | 功能完整，Bug 修复 |
| **M5: Release** | Week 18 | 正式发布 v1.0 |

---

## ⚡ 快速开发技巧

### 1. 使用代码片段
创建常用组件的代码片段，提高开发效率。

### 2. 模块化开发
每个组件独立开发和测试，降低耦合。

### 3. 先实现后优化
先确保功能正确，再进行性能优化。

### 4. 持续集成
使用 GitHub Actions 自动测试和构建。

### 5. 早期用户测试
Phase 6 后邀请用户测试，收集反馈。

---

## 🐛 常见问题预判

### 1. 状态栏刷新性能
**问题**: 频繁刷新导致 CPU 占用高
**解决**: 使用节流，秒级更新时用 Timer

### 2. 农历计算准确性
**问题**: 农历算法不准确
**解决**: 使用成熟的第三方库或官方算法

### 3. 节假日数据更新
**问题**: 节假日数据过期
**解决**: 提供在线更新功能 + 本地缓存

### 4. 多屏显示问题
**问题**: Popover 在多屏下位置错误
**解决**: 检测触发屏幕，在该屏幕显示

### 5. 内存泄漏
**问题**: 长时间运行内存增长
**解决**: 注意 Timer 和 Observer 的释放

---

## 📊 质量指标

### 性能指标
- 启动时间: < 0.5s
- 面板弹出: < 100ms
- CPU 占用: < 5% (空闲)
- 内存占用: < 50MB

### 代码质量
- 单元测试覆盖率: > 80%
- SwiftLint 警告: 0
- 代码重复率: < 5%

### 用户体验
- 崩溃率: < 0.1%
- 功能可用性: 100%
- 用户满意度: > 4.5/5

---

## 🔄 迭代计划

### v1.1 (发布后 1 个月)
- [ ] 自定义事件功能
- [ ] 主题颜色自定义
- [ ] iCloud 同步

### v1.2 (发布后 3 个月)
- [ ] 提醒事项集成
- [ ] 日历导出
- [ ] Widget 支持

### v2.0 (发布后 6 个月)
- [ ] iOS/iPadOS 版本
- [ ] 多日历支持
- [ ] AI 功能集成

---

## 📈 成功标准

### 技术标准
- ✓ 所有功能按设计实现
- ✓ 通过所有测试用例
- ✓ 性能达到目标指标

### 产品标准
- ✓ 用户体验流畅自然
- ✓ 符合 macOS 设计规范
- ✓ 无明显 Bug

### 市场标准 (可选)
- ✓ GitHub Stars > 100
- ✓ 活跃用户 > 1000
- ✓ 用户好评率 > 90%

---

**项目时间线**: 18 周 (约 4.5 个月)  
**团队规模**: 1-3 人  
**发布版本**: v1.0  
**最后更新**: 2024-10-24
